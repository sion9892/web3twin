<!DOCTYPE html>
<html>
<head>
    <title>Pinata API Key Test</title>
</head>
<body>
    <h1>Pinata API Key Test</h1>
    <div>
        <label>API Key:</label>
        <input type="text" id="apiKey" placeholder="Enter API Key" style="width: 300px; padding: 5px;">
    </div>
    <div style="margin-top: 10px;">
        <label>Secret Key:</label>
        <input type="text" id="secretKey" placeholder="Enter Secret Key" style="width: 300px; padding: 5px;">
    </div>
    <div style="margin-top: 10px;">
        <label>JWT Token:</label>
        <input type="text" id="jwtToken" placeholder="Enter JWT Token" style="width: 500px; padding: 5px;">
    </div>
    <button onclick="testKey()" style="margin-top: 10px; padding: 10px 20px;">Test API Key</button>
    <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>

    <script>
        async function testKey() {
            const apiKey = document.getElementById('apiKey').value;
            const secretKey = document.getElementById('secretKey').value;
            const jwtToken = document.getElementById('jwtToken').value;
            const resultDiv = document.getElementById('result');
            
            if (!apiKey && !secretKey && !jwtToken) {
                resultDiv.innerHTML = '<p style="color: red;">Please enter at least one credential</p>';
                return;
            }

            resultDiv.innerHTML = '<p>Testing API key...</p>';

            try {
                // 간단한 테스트 파일 업로드
                const testBlob = new Blob(['test'], { type: 'text/plain' });
                const testFile = new File([testBlob], 'test.txt', { type: 'text/plain' });
                
                const formData = new FormData();
                formData.append('file', testFile);
                
                const headers = {};
                if (jwtToken) {
                    headers['Authorization'] = `Bearer ${jwtToken}`;
                } else if (apiKey && secretKey) {
                    headers['pinata_api_key'] = apiKey;
                    headers['pinata_secret_api_key'] = secretKey;
                } else {
                    throw new Error('Need either JWT token or both API Key and Secret Key');
                }
                
                const response = await fetch('https://api.pinata.cloud/pinning/pinFileToIPFS', {
                    method: 'POST',
                    headers,
                    body: formData,
                });
                
                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(`HTTP ${response.status}: ${error}`);
                }
                
                const result = await response.json();
                
                resultDiv.innerHTML = `
                    <p style="color: green;">✅ API Key is valid!</p>
                    <p>Test file uploaded successfully.</p>
                    <p>CID: ${result.IpfsHash}</p>
                    <p>IPFS URL: ipfs://${result.IpfsHash}</p>
                    <p>Gateway URL: <a href="https://ipfs.io/ipfs/${result.IpfsHash}" target="_blank">https://ipfs.io/ipfs/${result.IpfsHash}</a></p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p style="color: red;">❌ API Key test failed</p>
                    <p>Error: ${error.message}</p>
                    <p><strong>Pinata API Key 형식:</strong></p>
                    <ul>
                        <li><strong>JWT Token</strong> (추천): eyJ로 시작하는 매우 긴 문자열 (200자 이상)</li>
                        <li><strong>API Key</strong>: 보통 32자리 영숫자</li>
                        <li><strong>Secret Key</strong>: 보통 64자리 영숫자</li>
                    </ul>
                    <p><strong>발급 방법:</strong></p>
                    <ol>
                        <li>https://www.pinata.cloud/ 방문</li>
                        <li>로그인 후 API Keys 메뉴</li>
                        <li>New Key 클릭</li>
                        <li>JWT Token 또는 API Key + Secret Key 생성</li>
                    </ol>
                `;
            }
        }
    </script>
</body>
</html>

